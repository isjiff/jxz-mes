{"remainingRequest":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\src\\views\\mes\\pro\\schedule\\ganttedit.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\src\\views\\mes\\pro\\schedule\\ganttedit.vue","mtime":1662109326000},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1662432868786},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\babel-loader\\lib\\index.js","mtime":1662432871518},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1662432868786},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\vue-loader\\lib\\index.js","mtime":1662432874590}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBHYW50dENoYXIgZnJvbSAiLi9nYW50dHgudnVlIjsKaW1wb3J0IHtsaXN0R2FudHRUYXNrTGlzdCx1cGRhdGVQcm90YXNrfSBmcm9tICJAL2FwaS9tZXMvcHJvL3Byb3Rhc2siOwpleHBvcnQgZGVmYXVsdCB7CiAgICBuYW1lOicnLAogICAgY29tcG9uZW50czp7R2FudHRDaGFyfSwKICAgIGRhdGEoKXsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICB0YXNrczp7CiAgICAgICAgICAgICAgICBkYXRhOiBbXSwKICAgICAgICAgICAgICAgIGxpbmtzOiBbXQogICAgICAgICAgICB9LAogICAgICAgICAgICBjaGFuZ2VkVGFza0lkczpbXSwKICAgICAgICAgICAgb3B0VHlwZTonZWRpdCcsCiAgICAgICAgICAgIC8vIOafpeivouWPguaVsAogICAgICAgICAgICBxdWVyeVBhcmFtczogewogICAgICAgICAgICAgICAgd29ya29yZGVyQ29kZTogbnVsbCwKICAgICAgICAgICAgICAgIHdvcmtvcmRlck5hbWU6IG51bGwsCiAgICAgICAgICAgICAgICBvcmRlclNvdXJjZTogbnVsbCwKICAgICAgICAgICAgICAgIHNvdXJjZUNvZGU6IG51bGwsCiAgICAgICAgICAgICAgICBwcm9kdWN0SWQ6IG51bGwsCiAgICAgICAgICAgICAgICBwcm9kdWN0Q29kZTogbnVsbCwKICAgICAgICAgICAgICAgIHByb2R1Y3ROYW1lOiBudWxsLAogICAgICAgICAgICAgICAgcHJvZHVjdFNwYzogbnVsbCwKICAgICAgICAgICAgICAgIHVuaXRPZk1lYXN1cmU6IG51bGwsCiAgICAgICAgICAgICAgICBxdWFudGl0eTogbnVsbCwKICAgICAgICAgICAgICAgIHF1YW50aXR5UHJvZHVjZWQ6IG51bGwsCiAgICAgICAgICAgICAgICBxdWFudGl0eUNoYW5nZWQ6IG51bGwsCiAgICAgICAgICAgICAgICBxdWFudGl0eVNjaGVkdWxlZDogbnVsbCwKICAgICAgICAgICAgICAgIGNsaWVudElkOiBudWxsLAogICAgICAgICAgICAgICAgY2xpZW50Q29kZTogbnVsbCwKICAgICAgICAgICAgICAgIGNsaWVudE5hbWU6IG51bGwsCiAgICAgICAgICAgICAgICByZXF1ZXN0RGF0ZTogbnVsbCwKICAgICAgICAgICAgICAgIHBhcmVudElkOiBudWxsLAogICAgICAgICAgICAgICAgYW5jZXN0b3JzOiBudWxsLAogICAgICAgICAgICAgICAgc3RhdHVzOiBudWxsLAogICAgICAgICAgICB9LAogICAgICAgICAgICBmb3JtOnsKICAgICAgICAgICAgICAgIHRhc2tJZDogbnVsbCwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHN0YXJ0VGltZTogbnVsbCwKICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBudWxsLAogICAgICAgICAgICAgICAgZW5kVGltZTogbnVsbCAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIHdhdGNoOiB7CiAgICAgICAgdGFza3MoKXsKICAgICAgICAgICAgY29uc29sZS5sb2coIlRhc2tDaGFuZ2VkIik7CiAgICAgICAgfQogICAgfSwKICAgIGNyZWF0ZWQoKXsKICAgICAgICB0aGlzLmdldEdhbnR0VGFza3MoKTsKICAgIH0sCiAgICBtZXRob2RzOiB7CiAgICAgICAgZ2V0R2FudHRUYXNrcygpewogICAgICAgICAgICBsaXN0R2FudHRUYXNrTGlzdCh0aGlzLnF1ZXJ5UGFyYW1zKS50aGVuKHJlc3BvbnNlID0+ewogICAgICAgICAgICAgICAgdGhpcy50YXNrcy5kYXRhID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgdGhpcy50YXNrcy5saW5rcyA9IHJlc3BvbnNlLmRhdGEubGlua3M7CiAgICAgICAgICAgICAgICB0aGlzLiRyZWZzLmdhbnR0Q2hhci5yZWxvYWQoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBoYW5kbGVVcGRhdGUoKXsKICAgICAgICAgICAgZGVidWdnZXI7CiAgICAgICAgICAgIGlmKHRoaXMuY2hhbmdlZFRhc2tJZHMubGVuZ3RoPjApewogICAgICAgICAgICAgICAgdGhpcy5yZXNldCgpOwogICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VkVGFza0lkcy5mb3JFYWNoKGlkID0+IHsKICAgICAgICAgICAgICAgICAgICBkZWJ1Z2dlcjsKICAgICAgICAgICAgICAgICAgICBsZXQgblRhc2sgPSB0aGlzLnRhc2tzLmRhdGEuZmlsdGVyKHRhc2sgPT4gdGFzay5pZCA9PSBpZClbMF07CiAgICAgICAgICAgICAgICAgICAgbGV0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKG5UYXNrLnN0YXJ0X2RhdGUpOwogICAgICAgICAgICAgICAgICAgIGxldCBlbmREYXRlID0gbmV3IERhdGUoblRhc2suZW5kX2RhdGUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybS50YXNrSWQgPSBuVGFzay5pZDsKICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcm0uc3RhcnRUaW1lID0gc3RhcnREYXRlLmdldEZ1bGxZZWFyKCkrJy0nKyhzdGFydERhdGUuZ2V0TW9udGgoKSsxKSsnLScrc3RhcnREYXRlLmdldERhdGUoKSsnICcrc3RhcnREYXRlLmdldEhvdXJzKCkrJzonK3N0YXJ0RGF0ZS5nZXRNaW51dGVzKCkrJzonK3N0YXJ0RGF0ZS5nZXRTZWNvbmRzKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JtLmR1cmF0aW9uID0gblRhc2suZHVyYXRpb247CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JtLmVuZFRpbWUgPSBlbmREYXRlLmdldEZ1bGxZZWFyKCkrJy0nKyhlbmREYXRlLmdldE1vbnRoKCkrMSkrJy0nK2VuZERhdGUuZ2V0RGF0ZSgpKycgJytlbmREYXRlLmdldEhvdXJzKCkrJzonK2VuZERhdGUuZ2V0TWludXRlcygpKyc6JytlbmREYXRlLmdldFNlY29uZHMoKTsKICAgICAgICAgICAgICAgICAgICB1cGRhdGVQcm90YXNrKHRoaXMuZm9ybSkudGhlbihyZXNwb25zZSA9PnsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coInVwZGF0ZSBzdWNjZXNzOiIraWQpOwogICAgICAgICAgICAgICAgICAgIH0sZXJyID0+ewogICAgICAgICAgICAgICAgICAgICAgICBkZWJ1Z2dlcjsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coInVwZGF0ZSBmYWlsZWQ6IitlcnIubXNnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VkVGFza0lkcyA9W107ICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGhpcy4kbW9kYWwubXNnU3VjY2Vzcygi5L+d5a2Y5oiQ5YqfIik7CiAgICAgICAgICAgIH0gICAgICAgICAgICAKICAgICAgICB9LAogICAgICAgIGhhbmRsZVJlZnJlc2goKXsKICAgICAgICAgICAgdGhpcy4kcmVmcy5nYW50dENoYXIucmVsb2FkKCk7CiAgICAgICAgfSwKICAgICAgICBoYW5kbGVDbG9zZSgpewogICAgICAgICAgICBjb25zdCBvYmogPSB7IHBhdGg6ICIvbWVzL3Byby9wcm9zY2hlZHVsZSIgfTsKICAgICAgICAgICAgdGhpcy4kdGFiLmNsb3NlT3BlblBhZ2Uob2JqKTsKICAgICAgICB9LAogICAgICAgIHJlc2V0KCkgewogICAgICAgICAgICB0aGlzLmZvcm0gPSB7CiAgICAgICAgICAgICAgICB0YXNrSWQ6IG51bGwsCiAgICAgICAgICAgICAgICBzdGFydFRpbWU6IG51bGwsCiAgICAgICAgICAgICAgICBkdXJhdGlvbjogbnVsbCwKICAgICAgICAgICAgICAgIGVuZFRpbWU6IG51bGwsCiAgICAgICAgICAgIH07CiAgICAgICAgfSwKCiAgICB9Cn0K"},{"version":3,"sources":["ganttedit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"ganttedit.vue","sourceRoot":"src/views/mes/pro/schedule","sourcesContent":["<template>\n    <div class=\"app-container\">\n    <el-row :gutter=\"10\" class=\"mb8\">\n      <el-col :span=\"1\"></el-col>\n      <el-col :span=\"1.5\">\n        <el-button\n          type=\"success\"\n          plain\n          icon=\"el-icon-edit\"\n          size=\"mini\"\n          @click=\"handleUpdate\"\n          v-hasPermi=\"['mes:pro:schedule:edit']\"\n        >保存</el-button>\n      </el-col>\n      <el-col :span=\"1.5\">\n        <el-button\n          type=\"danger\"\n          plain\n          icon=\"el-icon-delete\"\n          size=\"mini\"\n          @click=\"handleClose\"\n        >关闭</el-button>\n      </el-col>\n      <el-col :span=\"1.5\">\n        <el-button\n          type=\"warning\"\n          plain\n          icon=\"el-icon-refresh\"\n          size=\"mini\"\n          @click=\"handleRefresh\"\n        >重新加载</el-button>\n      </el-col>\n    </el-row>\n    <div class=\"wrapper\">\n      <div class=\"container\">\n        <GanttChar class=\"left-container\" ref=\"ganttChar\" optType=\"edit\" :ids=\"changedTaskIds\" :tasks=\"tasks\"></GanttChar>\n      </div>      \n    </div> \n    </div>\n</template>\n\n<script>\nimport GanttChar from \"./ganttx.vue\";\nimport {listGanttTaskList,updateProtask} from \"@/api/mes/pro/protask\";\nexport default {\n    name:'',\n    components:{GanttChar},\n    data(){\n        return {\n            tasks:{\n                data: [],\n                links: []\n            },\n            changedTaskIds:[],\n            optType:'edit',\n            // 查询参数\n            queryParams: {\n                workorderCode: null,\n                workorderName: null,\n                orderSource: null,\n                sourceCode: null,\n                productId: null,\n                productCode: null,\n                productName: null,\n                productSpc: null,\n                unitOfMeasure: null,\n                quantity: null,\n                quantityProduced: null,\n                quantityChanged: null,\n                quantityScheduled: null,\n                clientId: null,\n                clientCode: null,\n                clientName: null,\n                requestDate: null,\n                parentId: null,\n                ancestors: null,\n                status: null,\n            },\n            form:{\n                taskId: null,                              \n                startTime: null,\n                duration: null,\n                endTime: null            \n            }\n        }\n    },\n    watch: {\n        tasks(){\n            console.log(\"TaskChanged\");\n        }\n    },\n    created(){\n        this.getGanttTasks();\n    },\n    methods: {\n        getGanttTasks(){\n            listGanttTaskList(this.queryParams).then(response =>{\n                this.tasks.data = response.data.data;\n                this.tasks.links = response.data.links;\n                this.$refs.ganttChar.reload();\n            });\n        },\n        handleUpdate(){\n            debugger;\n            if(this.changedTaskIds.length>0){\n                this.reset();\n                this.changedTaskIds.forEach(id => {\n                    debugger;\n                    let nTask = this.tasks.data.filter(task => task.id == id)[0];\n                    let startDate = new Date(nTask.start_date);\n                    let endDate = new Date(nTask.end_date);\n                    this.form.taskId = nTask.id;\n                    this.form.startTime = startDate.getFullYear()+'-'+(startDate.getMonth()+1)+'-'+startDate.getDate()+' '+startDate.getHours()+':'+startDate.getMinutes()+':'+startDate.getSeconds();\n                    this.form.duration = nTask.duration;\n                    this.form.endTime = endDate.getFullYear()+'-'+(endDate.getMonth()+1)+'-'+endDate.getDate()+' '+endDate.getHours()+':'+endDate.getMinutes()+':'+endDate.getSeconds();\n                    updateProtask(this.form).then(response =>{\n                        console.log(\"update success:\"+id);\n                    },err =>{\n                        debugger;\n                        console.log(\"update failed:\"+err.msg);\n                    });\n                });\n                this.changedTaskIds =[];                \n                this.$modal.msgSuccess(\"保存成功\");\n            }            \n        },\n        handleRefresh(){\n            this.$refs.ganttChar.reload();\n        },\n        handleClose(){\n            const obj = { path: \"/mes/pro/proschedule\" };\n            this.$tab.closeOpenPage(obj);\n        },\n        reset() {\n            this.form = {\n                taskId: null,\n                startTime: null,\n                duration: null,\n                endTime: null,\n            };\n        },\n\n    }\n}\n</script>\n\n<style scoped>\n.wrapper{\n    height: 700px;\n}\n.container {\n  height: 100%;\n  width: 100%;\n}\n.left-container {\n  overflow: hidden;\n  position: relative;\n  height: 100%;\n}\n</style>"]}]}