{"remainingRequest":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\src\\views\\mes\\pro\\schedule\\ganttedit.vue?vue&type=style&index=0&id=3ba73bd6&scoped=true&lang=css&","dependencies":[{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\src\\views\\mes\\pro\\schedule\\ganttedit.vue","mtime":1662109326000},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\css-loader\\dist\\cjs.js","mtime":1662432869776},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1662432875697},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\postcss-loader\\src\\index.js","mtime":1662432871503},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1662432868786},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\vue-loader\\lib\\index.js","mtime":1662432874590}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLndyYXBwZXJ7CiAgICBoZWlnaHQ6IDcwMHB4Owp9Ci5jb250YWluZXIgewogIGhlaWdodDogMTAwJTsKICB3aWR0aDogMTAwJTsKfQoubGVmdC1jb250YWluZXIgewogIG92ZXJmbG93OiBoaWRkZW47CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGhlaWdodDogMTAwJTsKfQo="},{"version":3,"sources":["ganttedit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ganttedit.vue","sourceRoot":"src/views/mes/pro/schedule","sourcesContent":["<template>\n    <div class=\"app-container\">\n    <el-row :gutter=\"10\" class=\"mb8\">\n      <el-col :span=\"1\"></el-col>\n      <el-col :span=\"1.5\">\n        <el-button\n          type=\"success\"\n          plain\n          icon=\"el-icon-edit\"\n          size=\"mini\"\n          @click=\"handleUpdate\"\n          v-hasPermi=\"['mes:pro:schedule:edit']\"\n        >保存</el-button>\n      </el-col>\n      <el-col :span=\"1.5\">\n        <el-button\n          type=\"danger\"\n          plain\n          icon=\"el-icon-delete\"\n          size=\"mini\"\n          @click=\"handleClose\"\n        >关闭</el-button>\n      </el-col>\n      <el-col :span=\"1.5\">\n        <el-button\n          type=\"warning\"\n          plain\n          icon=\"el-icon-refresh\"\n          size=\"mini\"\n          @click=\"handleRefresh\"\n        >重新加载</el-button>\n      </el-col>\n    </el-row>\n    <div class=\"wrapper\">\n      <div class=\"container\">\n        <GanttChar class=\"left-container\" ref=\"ganttChar\" optType=\"edit\" :ids=\"changedTaskIds\" :tasks=\"tasks\"></GanttChar>\n      </div>      \n    </div> \n    </div>\n</template>\n\n<script>\nimport GanttChar from \"./ganttx.vue\";\nimport {listGanttTaskList,updateProtask} from \"@/api/mes/pro/protask\";\nexport default {\n    name:'',\n    components:{GanttChar},\n    data(){\n        return {\n            tasks:{\n                data: [],\n                links: []\n            },\n            changedTaskIds:[],\n            optType:'edit',\n            // 查询参数\n            queryParams: {\n                workorderCode: null,\n                workorderName: null,\n                orderSource: null,\n                sourceCode: null,\n                productId: null,\n                productCode: null,\n                productName: null,\n                productSpc: null,\n                unitOfMeasure: null,\n                quantity: null,\n                quantityProduced: null,\n                quantityChanged: null,\n                quantityScheduled: null,\n                clientId: null,\n                clientCode: null,\n                clientName: null,\n                requestDate: null,\n                parentId: null,\n                ancestors: null,\n                status: null,\n            },\n            form:{\n                taskId: null,                              \n                startTime: null,\n                duration: null,\n                endTime: null            \n            }\n        }\n    },\n    watch: {\n        tasks(){\n            console.log(\"TaskChanged\");\n        }\n    },\n    created(){\n        this.getGanttTasks();\n    },\n    methods: {\n        getGanttTasks(){\n            listGanttTaskList(this.queryParams).then(response =>{\n                this.tasks.data = response.data.data;\n                this.tasks.links = response.data.links;\n                this.$refs.ganttChar.reload();\n            });\n        },\n        handleUpdate(){\n            debugger;\n            if(this.changedTaskIds.length>0){\n                this.reset();\n                this.changedTaskIds.forEach(id => {\n                    debugger;\n                    let nTask = this.tasks.data.filter(task => task.id == id)[0];\n                    let startDate = new Date(nTask.start_date);\n                    let endDate = new Date(nTask.end_date);\n                    this.form.taskId = nTask.id;\n                    this.form.startTime = startDate.getFullYear()+'-'+(startDate.getMonth()+1)+'-'+startDate.getDate()+' '+startDate.getHours()+':'+startDate.getMinutes()+':'+startDate.getSeconds();\n                    this.form.duration = nTask.duration;\n                    this.form.endTime = endDate.getFullYear()+'-'+(endDate.getMonth()+1)+'-'+endDate.getDate()+' '+endDate.getHours()+':'+endDate.getMinutes()+':'+endDate.getSeconds();\n                    updateProtask(this.form).then(response =>{\n                        console.log(\"update success:\"+id);\n                    },err =>{\n                        debugger;\n                        console.log(\"update failed:\"+err.msg);\n                    });\n                });\n                this.changedTaskIds =[];                \n                this.$modal.msgSuccess(\"保存成功\");\n            }            \n        },\n        handleRefresh(){\n            this.$refs.ganttChar.reload();\n        },\n        handleClose(){\n            const obj = { path: \"/mes/pro/proschedule\" };\n            this.$tab.closeOpenPage(obj);\n        },\n        reset() {\n            this.form = {\n                taskId: null,\n                startTime: null,\n                duration: null,\n                endTime: null,\n            };\n        },\n\n    }\n}\n</script>\n\n<style scoped>\n.wrapper{\n    height: 700px;\n}\n.container {\n  height: 100%;\n  width: 100%;\n}\n.left-container {\n  overflow: hidden;\n  position: relative;\n  height: 100%;\n}\n</style>"]}]}