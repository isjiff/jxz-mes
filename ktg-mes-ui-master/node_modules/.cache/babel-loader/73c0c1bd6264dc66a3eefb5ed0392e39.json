{"remainingRequest":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\babel-loader\\lib\\index.js!D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\src\\views\\mes\\pro\\schedule\\ganttedit.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\src\\views\\mes\\pro\\schedule\\ganttedit.vue","mtime":1665505269000},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\babel.config.js","mtime":1665505269000},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1662432868786},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\babel-loader\\lib\\index.js","mtime":1662432871518},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1662432868786},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\vue-loader\\lib\\index.js","mtime":1662432874590}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKCJEOi9yZXNvdXJjZS9lY2xpcHNlLXdvcmtzcGFjZS9rdGctbWVzLW1hc3Rlci9rdGctbWVzLXVpLW1hc3Rlci9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9pbnRlcm9wUmVxdWlyZURlZmF1bHQuanMiKS5kZWZhdWx0OwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmRlZmF1bHQgPSB2b2lkIDA7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIuanMiKTsKCnZhciBfZ2FudHR4ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCIuL2dhbnR0eC52dWUiKSk7Cgp2YXIgX3Byb3Rhc2sgPSByZXF1aXJlKCJAL2FwaS9tZXMvcHJvL3Byb3Rhc2siKTsKCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCnZhciBfZGVmYXVsdCA9IHsKICBuYW1lOiAnJywKICBjb21wb25lbnRzOiB7CiAgICBHYW50dENoYXI6IF9nYW50dHguZGVmYXVsdAogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHRhc2tzOiB7CiAgICAgICAgZGF0YTogW10sCiAgICAgICAgbGlua3M6IFtdCiAgICAgIH0sCiAgICAgIGNoYW5nZWRUYXNrSWRzOiBbXSwKICAgICAgb3B0VHlwZTogJ2VkaXQnLAogICAgICAvLyDmn6Xor6Llj4LmlbAKICAgICAgcXVlcnlQYXJhbXM6IHsKICAgICAgICB3b3Jrb3JkZXJDb2RlOiBudWxsLAogICAgICAgIHdvcmtvcmRlck5hbWU6IG51bGwsCiAgICAgICAgb3JkZXJTb3VyY2U6IG51bGwsCiAgICAgICAgc291cmNlQ29kZTogbnVsbCwKICAgICAgICBwcm9kdWN0SWQ6IG51bGwsCiAgICAgICAgcHJvZHVjdENvZGU6IG51bGwsCiAgICAgICAgcHJvZHVjdE5hbWU6IG51bGwsCiAgICAgICAgcHJvZHVjdFNwYzogbnVsbCwKICAgICAgICB1bml0T2ZNZWFzdXJlOiBudWxsLAogICAgICAgIHF1YW50aXR5OiBudWxsLAogICAgICAgIHF1YW50aXR5UHJvZHVjZWQ6IG51bGwsCiAgICAgICAgcXVhbnRpdHlDaGFuZ2VkOiBudWxsLAogICAgICAgIHF1YW50aXR5U2NoZWR1bGVkOiBudWxsLAogICAgICAgIGNsaWVudElkOiBudWxsLAogICAgICAgIGNsaWVudENvZGU6IG51bGwsCiAgICAgICAgY2xpZW50TmFtZTogbnVsbCwKICAgICAgICByZXF1ZXN0RGF0ZTogbnVsbCwKICAgICAgICBwYXJlbnRJZDogbnVsbCwKICAgICAgICBhbmNlc3RvcnM6IG51bGwsCiAgICAgICAgc3RhdHVzOiBudWxsCiAgICAgIH0sCiAgICAgIGZvcm06IHsKICAgICAgICB0YXNrSWQ6IG51bGwsCiAgICAgICAgc3RhcnRUaW1lOiBudWxsLAogICAgICAgIGR1cmF0aW9uOiBudWxsLAogICAgICAgIGVuZFRpbWU6IG51bGwKICAgICAgfQogICAgfTsKICB9LAogIHdhdGNoOiB7CiAgICB0YXNrczogZnVuY3Rpb24gdGFza3MoKSB7CiAgICAgIGNvbnNvbGUubG9nKCJUYXNrQ2hhbmdlZCIpOwogICAgfQogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIHRoaXMuZ2V0R2FudHRUYXNrcygpOwogIH0sCiAgbWV0aG9kczogewogICAgZ2V0R2FudHRUYXNrczogZnVuY3Rpb24gZ2V0R2FudHRUYXNrcygpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICgwLCBfcHJvdGFzay5saXN0R2FudHRUYXNrTGlzdCkodGhpcy5xdWVyeVBhcmFtcykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpcy50YXNrcy5kYXRhID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgIF90aGlzLnRhc2tzLmxpbmtzID0gcmVzcG9uc2UuZGF0YS5saW5rczsKCiAgICAgICAgX3RoaXMuJHJlZnMuZ2FudHRDaGFyLnJlbG9hZCgpOwogICAgICB9KTsKICAgIH0sCiAgICBoYW5kbGVVcGRhdGU6IGZ1bmN0aW9uIGhhbmRsZVVwZGF0ZSgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICBkZWJ1Z2dlcjsKCiAgICAgIGlmICh0aGlzLmNoYW5nZWRUYXNrSWRzLmxlbmd0aCA+IDApIHsKICAgICAgICB0aGlzLnJlc2V0KCk7CiAgICAgICAgdGhpcy5jaGFuZ2VkVGFza0lkcy5mb3JFYWNoKGZ1bmN0aW9uIChpZCkgewogICAgICAgICAgZGVidWdnZXI7CgogICAgICAgICAgdmFyIG5UYXNrID0gX3RoaXMyLnRhc2tzLmRhdGEuZmlsdGVyKGZ1bmN0aW9uICh0YXNrKSB7CiAgICAgICAgICAgIHJldHVybiB0YXNrLmlkID09IGlkOwogICAgICAgICAgfSlbMF07CgogICAgICAgICAgdmFyIHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKG5UYXNrLnN0YXJ0X2RhdGUpOwogICAgICAgICAgdmFyIGVuZERhdGUgPSBuZXcgRGF0ZShuVGFzay5lbmRfZGF0ZSk7CiAgICAgICAgICBfdGhpczIuZm9ybS50YXNrSWQgPSBuVGFzay5pZDsKICAgICAgICAgIF90aGlzMi5mb3JtLnN0YXJ0VGltZSA9IHN0YXJ0RGF0ZS5nZXRGdWxsWWVhcigpICsgJy0nICsgKHN0YXJ0RGF0ZS5nZXRNb250aCgpICsgMSkgKyAnLScgKyBzdGFydERhdGUuZ2V0RGF0ZSgpICsgJyAnICsgc3RhcnREYXRlLmdldEhvdXJzKCkgKyAnOicgKyBzdGFydERhdGUuZ2V0TWludXRlcygpICsgJzonICsgc3RhcnREYXRlLmdldFNlY29uZHMoKTsKICAgICAgICAgIF90aGlzMi5mb3JtLmR1cmF0aW9uID0gblRhc2suZHVyYXRpb247CiAgICAgICAgICBfdGhpczIuZm9ybS5lbmRUaW1lID0gZW5kRGF0ZS5nZXRGdWxsWWVhcigpICsgJy0nICsgKGVuZERhdGUuZ2V0TW9udGgoKSArIDEpICsgJy0nICsgZW5kRGF0ZS5nZXREYXRlKCkgKyAnICcgKyBlbmREYXRlLmdldEhvdXJzKCkgKyAnOicgKyBlbmREYXRlLmdldE1pbnV0ZXMoKSArICc6JyArIGVuZERhdGUuZ2V0U2Vjb25kcygpOwogICAgICAgICAgKDAsIF9wcm90YXNrLnVwZGF0ZVByb3Rhc2spKF90aGlzMi5mb3JtKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygidXBkYXRlIHN1Y2Nlc3M6IiArIGlkKTsKICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgICAgZGVidWdnZXI7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJ1cGRhdGUgZmFpbGVkOiIgKyBlcnIubXNnKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuY2hhbmdlZFRhc2tJZHMgPSBbXTsKICAgICAgICB0aGlzLiRtb2RhbC5tc2dTdWNjZXNzKCLkv53lrZjmiJDlip8iKTsKICAgICAgfQogICAgfSwKICAgIGhhbmRsZVJlZnJlc2g6IGZ1bmN0aW9uIGhhbmRsZVJlZnJlc2goKSB7CiAgICAgIHRoaXMuJHJlZnMuZ2FudHRDaGFyLnJlbG9hZCgpOwogICAgfSwKICAgIGhhbmRsZUNsb3NlOiBmdW5jdGlvbiBoYW5kbGVDbG9zZSgpIHsKICAgICAgdmFyIG9iaiA9IHsKICAgICAgICBwYXRoOiAiL21lcy9wcm8vcHJvc2NoZWR1bGUiCiAgICAgIH07CiAgICAgIHRoaXMuJHRhYi5jbG9zZU9wZW5QYWdlKG9iaik7CiAgICB9LAogICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KCkgewogICAgICB0aGlzLmZvcm0gPSB7CiAgICAgICAgdGFza0lkOiBudWxsLAogICAgICAgIHN0YXJ0VGltZTogbnVsbCwKICAgICAgICBkdXJhdGlvbjogbnVsbCwKICAgICAgICBlbmRUaW1lOiBudWxsCiAgICAgIH07CiAgICB9CiAgfQp9OwpleHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDs="},{"version":3,"mappings":";;;;;;;;;;;;;;;AA0CA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eACA;EACAA,QADA;EAEAC;IAAAC;EAAA,CAFA;EAGAC,IAHA,kBAGA;IACA;MACAC;QACAD,QADA;QAEAE;MAFA,CADA;MAKAC,kBALA;MAMAC,eANA;MAOA;MACAC;QACAC,mBADA;QAEAC,mBAFA;QAGAC,iBAHA;QAIAC,gBAJA;QAKAC,eALA;QAMAC,iBANA;QAOAC,iBAPA;QAQAC,gBARA;QASAC,mBATA;QAUAC,cAVA;QAWAC,sBAXA;QAYAC,qBAZA;QAaAC,uBAbA;QAcAC,cAdA;QAeAC,gBAfA;QAgBAC,gBAhBA;QAiBAC,iBAjBA;QAkBAC,cAlBA;QAmBAC,eAnBA;QAoBAC;MApBA,CARA;MA8BAC;QACAC,YADA;QAEAC,eAFA;QAGAC,cAHA;QAIAC;MAJA;IA9BA;EAqCA,CAzCA;EA0CAC;IACA9B,KADA,mBACA;MACA+B;IACA;EAHA,CA1CA;EA+CAC,OA/CA,qBA+CA;IACA;EACA,CAjDA;EAkDAC;IACAC,aADA,2BACA;MAAA;;MACA;QACA;QACA;;QACA;MACA,CAJA;IAKA,CAPA;IAQAC,YARA,0BAQA;MAAA;;MACA;;MACA;QACA;QACA;UACA;;UACA;YAAA;UAAA;;UACA;UACA;UACA;UACA;UACA;UACA;UACA;YACAJ;UACA,CAFA,EAEA;YACA;YACAA;UACA,CALA;QAMA,CAfA;QAgBA;QACA;MACA;IACA,CA/BA;IAgCAK,aAhCA,2BAgCA;MACA;IACA,CAlCA;IAmCAC,WAnCA,yBAmCA;MACA;QAAAC;MAAA;MACA;IACA,CAtCA;IAuCAC,KAvCA,mBAuCA;MACA;QACAb,YADA;QAEAC,eAFA;QAGAC,cAHA;QAIAC;MAJA;IAMA;EA9CA;AAlDA,C","names":["name","components","GanttChar","data","tasks","links","changedTaskIds","optType","queryParams","workorderCode","workorderName","orderSource","sourceCode","productId","productCode","productName","productSpc","unitOfMeasure","quantity","quantityProduced","quantityChanged","quantityScheduled","clientId","clientCode","clientName","requestDate","parentId","ancestors","status","form","taskId","startTime","duration","endTime","watch","console","created","methods","getGanttTasks","handleUpdate","handleRefresh","handleClose","path","reset"],"sourceRoot":"src/views/mes/pro/schedule","sources":["ganttedit.vue"],"sourcesContent":["<template>\n    <div class=\"app-container\">\n    <el-row :gutter=\"10\" class=\"mb8\">\n      <el-col :span=\"1\"></el-col>\n      <el-col :span=\"1.5\">\n        <el-button\n          type=\"success\"\n          plain\n          icon=\"el-icon-edit\"\n          size=\"mini\"\n          @click=\"handleUpdate\"\n          v-hasPermi=\"['mes:pro:schedule:edit']\"\n        >保存</el-button>\n      </el-col>\n      <el-col :span=\"1.5\">\n        <el-button\n          type=\"danger\"\n          plain\n          icon=\"el-icon-delete\"\n          size=\"mini\"\n          @click=\"handleClose\"\n        >关闭</el-button>\n      </el-col>\n      <el-col :span=\"1.5\">\n        <el-button\n          type=\"warning\"\n          plain\n          icon=\"el-icon-refresh\"\n          size=\"mini\"\n          @click=\"handleRefresh\"\n        >重新加载</el-button>\n      </el-col>\n    </el-row>\n    <div class=\"wrapper\">\n      <div class=\"container\">\n        <GanttChar class=\"left-container\" ref=\"ganttChar\" optType=\"edit\" :ids=\"changedTaskIds\" :tasks=\"tasks\"></GanttChar>\n      </div>      \n    </div> \n    </div>\n</template>\n\n<script>\nimport GanttChar from \"./ganttx.vue\";\nimport {listGanttTaskList,updateProtask} from \"@/api/mes/pro/protask\";\nexport default {\n    name:'',\n    components:{GanttChar},\n    data(){\n        return {\n            tasks:{\n                data: [],\n                links: []\n            },\n            changedTaskIds:[],\n            optType:'edit',\n            // 查询参数\n            queryParams: {\n                workorderCode: null,\n                workorderName: null,\n                orderSource: null,\n                sourceCode: null,\n                productId: null,\n                productCode: null,\n                productName: null,\n                productSpc: null,\n                unitOfMeasure: null,\n                quantity: null,\n                quantityProduced: null,\n                quantityChanged: null,\n                quantityScheduled: null,\n                clientId: null,\n                clientCode: null,\n                clientName: null,\n                requestDate: null,\n                parentId: null,\n                ancestors: null,\n                status: null,\n            },\n            form:{\n                taskId: null,                              \n                startTime: null,\n                duration: null,\n                endTime: null            \n            }\n        }\n    },\n    watch: {\n        tasks(){\n            console.log(\"TaskChanged\");\n        }\n    },\n    created(){\n        this.getGanttTasks();\n    },\n    methods: {\n        getGanttTasks(){\n            listGanttTaskList(this.queryParams).then(response =>{\n                this.tasks.data = response.data.data;\n                this.tasks.links = response.data.links;\n                this.$refs.ganttChar.reload();\n            });\n        },\n        handleUpdate(){\n            debugger;\n            if(this.changedTaskIds.length>0){\n                this.reset();\n                this.changedTaskIds.forEach(id => {\n                    debugger;\n                    let nTask = this.tasks.data.filter(task => task.id == id)[0];\n                    let startDate = new Date(nTask.start_date);\n                    let endDate = new Date(nTask.end_date);\n                    this.form.taskId = nTask.id;\n                    this.form.startTime = startDate.getFullYear()+'-'+(startDate.getMonth()+1)+'-'+startDate.getDate()+' '+startDate.getHours()+':'+startDate.getMinutes()+':'+startDate.getSeconds();\n                    this.form.duration = nTask.duration;\n                    this.form.endTime = endDate.getFullYear()+'-'+(endDate.getMonth()+1)+'-'+endDate.getDate()+' '+endDate.getHours()+':'+endDate.getMinutes()+':'+endDate.getSeconds();\n                    updateProtask(this.form).then(response =>{\n                        console.log(\"update success:\"+id);\n                    },err =>{\n                        debugger;\n                        console.log(\"update failed:\"+err.msg);\n                    });\n                });\n                this.changedTaskIds =[];                \n                this.$modal.msgSuccess(\"保存成功\");\n            }            \n        },\n        handleRefresh(){\n            this.$refs.ganttChar.reload();\n        },\n        handleClose(){\n            const obj = { path: \"/mes/pro/proschedule\" };\n            this.$tab.closeOpenPage(obj);\n        },\n        reset() {\n            this.form = {\n                taskId: null,\n                startTime: null,\n                duration: null,\n                endTime: null,\n            };\n        },\n\n    }\n}\n</script>\n\n<style scoped>\n.wrapper{\n    height: 700px;\n}\n.container {\n  height: 100%;\n  width: 100%;\n}\n.left-container {\n  overflow: hidden;\n  position: relative;\n  height: 100%;\n}\n</style>"]}]}