{"remainingRequest":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\src\\views\\mes\\md\\mditem\\components\\sop.vue?vue&type=style&index=0&id=4f0e5e14&scoped=true&lang=css&","dependencies":[{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\src\\views\\mes\\md\\mditem\\components\\sop.vue","mtime":1665505269000},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\css-loader\\dist\\cjs.js","mtime":1662432869776},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1662432875697},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\postcss-loader\\src\\index.js","mtime":1662432871503},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1662432868786},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\vue-loader\\lib\\index.js","mtime":1662432874590}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmhlYWRlciB7CiAgICBtYXJnaW4tbGVmdDogMTVweDsKICAgIGZvbnQtc2l6ZTogMzBweDsKICAgIGZvbnQtd2VpZ2h0OiA2MDA7Cn0KCi5pbWFnZXMgewogICAgZGlzcGxheTogZmxleDsKICAgIG1hcmdpbi10b3A6IDIwcHg7CiAgICBtYXJnaW4tbGVmdDogMjFweDsKICAgIG1hcmdpbi1yaWdodDogMjBweDsKICAgIGZsZXgtd3JhcDogd3JhcDsKfQoKLmltYWdlLW1pZGRsZXsKICAgIG1hcmdpbi1yaWdodDogMTVweDsKICAgIG1hcmdpbi1ib3R0b206IDE1cHg7Cn0KCi5pbWFnZXsKICAgIHdpZHRoOjExMHB4OwogICAgaGVpZ2h0OiAxMTBweDsKfQoKLmltYWdlUHJldmlldyB7CiAgICB3aWR0aDogNjAwcHg7CiAgICBoZWlnaHQ6IDUwMHB4Owp9Cg=="},{"version":3,"sources":["sop.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4MA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"sop.vue","sourceRoot":"src/views/mes/md/mditem/components","sourcesContent":["<template>\n    <div class=\"app-container\">\n        <el-row v-if=\"optType != 'view'\" :gutter=\"10\" class=\"mb8\">\n            <el-col :span=\"1.5\">\n                <el-button\n                type=\"primary\"\n                plain\n                icon=\"el-icon-plus\"\n                size=\"mini\"\n                @click=\"handleAdd\"\n                v-hasPermi=\"['mes:md:sop:add']\"\n                >新增</el-button>\n            </el-col>\n        </el-row>\n        <div class=\"header\">\n            <el-dialog :title=\"title\" :visible.sync=\"open\" width=\"960px\" append-to-body>\n                <el-form ref=\"form\" :model=\"form\" :rules=\"rules\" label-width=\"100px\">\n                    <el-form-item label=\"标题\" prop=\"sopTitle\">\n                        <el-input v-model=\"form.sopTitle\" placeholder=\"请输入标题\"></el-input>\n                    </el-form-item>\n                    <el-form-item label=\"展示顺序\">\n                        <el-input-number :min=\"1\" v-model=\"form.orderNum\"></el-input-number>\n                    </el-form-item>\n                    <el-form-item label=\"内容说明\">\n                        <el-input type=\"textarea\" v-model=\"form.sopDescription\" placeholder=\"请输入说明信息\"></el-input>\n                    </el-form-item>\n                    <el-form-item label=\"所属工序\" prop=\"processId\">\n                        <el-select v-model=\"form.processId\" placeholder=\"请选择工序\">\n                            <el-option\n                            v-for=\"item in processOptions\"\n                            :key=\"item.processId\"\n                            :label=\"item.processName\"\n                            :value=\"item.processId\"\n                            ></el-option>\n                        </el-select>\n                    </el-form-item>\n                    <el-form-item label=\"图片\">\n                        <ImageUpload :limit=\"1\" :value=\"form.sopUrl\" :fileSize=\"5\" @onUploaded=\"handleImgUplaoded\" @onRemoved=\"handleImgRemoved\" ></ImageUpload>\n                    </el-form-item>                    \n                </el-form>\n                <div slot=\"footer\" class=\"dialog-footer\">\n                    <el-button type=\"primary\" @click=\"submitForm\">提 交</el-button>\n                    <el-button @click=\"cancel\">取 消</el-button>\n                </div>\n            </el-dialog>\n        </div>\n        <div class=\"images\">\n            <div v-for=\"(item,index) in sopList\" :key=\"index\" class=\"image-middle\">\n                <el-card shadow=\"hover\" :body-style=\"{pading: '10px'}\">\n                    <el-popover>\n                        <img :src=\"sopList[index].sopUrl\" slot=\"reference\" class=\"image\"/>\n                        <el-image class=\"imagePreview\" :src=\"sopList[index].sopUrl\" :preview-src-list=\"imageList\"></el-image>                        \n                    </el-popover>\n                    <div style=\"text-align:center;padding-top:12px\">\n                        <span>\n                            {{sopList[index].sopTitle}}\n                        </span>\n                        <el-button @click=\"handleUpdate(sopList[index])\" type=\"primary\" icon=\"el-icon-edit\"></el-button>\n                        <el-button @click=\"handleDelete(sopList[index])\" type=\"danger\" icon=\"el-icon-delete\"></el-button>\n                    </div>\n                </el-card>\n            </div>\n        </div>\n    </div>\n</template>\n<script>\nimport { listSop, getSop, delSop, addSop, updateSop } from \"@/api/mes/md/sop\";\nimport ImageUpload from \"@/components/ImageUpload/index.vue\"\nimport {listAllProcess} from \"@/api/mes/pro/process\";\nexport default{\n    name: \"SOPTab\",\n    components: {ImageUpload},\n    props:{\n        itemId: null,\n        optType: null,\n    },\n    data(){\n        return {\n            title: \"新增SOP信息\",\n            loading: true,\n            open: false,      \n            // 表单参数\n            form: {},\n            // 表单校验\n            rules: {\n                itemId: [\n                    { required: true, message: \"物料产品ID不能为空\", trigger: \"blur\" }\n                ],\n            },     \n            // 产品SOP表格数据\n            sopList: [], \n            //用于图片预览的清单\n            imageList: [],\n            //工序选项\n            processOptions:[],\n            queryParams: {\n                itemId: this.itemId\n            }            \n        }\n    },\n    created(){\n        this.getList();\n        this.getProcess();\n    },\n    methods: {\n        //获取当前产品的SOP资料清单\n        getList(){\n            listSop(this.queryParams).then(response =>{\n                debugger;\n                this.imageList = [];\n                this.sopList = response.rows;\n                this.sopList.forEach(row => {\n                    this.imageList.push(row.sopUrl);\n                });\n            });\n        },\n         //查询工序信息\n        getProcess(){\n            listAllProcess().then( response =>{\n                this.processOptions = response.data;\n            });\n        },\n        // 取消按钮\n        cancel() {\n            this.open = false;\n            this.reset();\n        },\n        // 表单重置\n        reset() {\n            this.form = {\n                sopId: null,\n                itemId: this.itemId,\n                orderNum: null,\n                processId: null,\n                processCode: null,\n                processName: null,\n                sopTitle: null,\n                sopDescription: null,\n                sopUrl: null               \n            };\n            this.resetForm(\"form\");\n        },\n        /**\n         * 新增操作\n         */\n        handleAdd(){\n            this.reset();\n            this.open = true;\n            this.title = \"添加产品SOP\";\n        },\n        /** 修改按钮操作 */\n        handleUpdate(row) {\n            this.reset();\n            const sopId = row.sopId || this.ids\n            getSop(sopId).then(response => {\n                this.form = response.data;\n                this.open = true;\n                this.title = \"修改产品SOP\";\n            });\n        },\n        //图片上传成功\n        handleImgUplaoded(imgUrl){\n            console.log(imgUrl);\n            this.form.sopUrl = imgUrl;\n        },\n        //图片移除\n        handleImgRemoved(imgUrl){\n            console.log(imgUrl);\n            this.form.sopUrl = null;            \n        },\n        //提交\n        submitForm(){\n            this.$refs[\"form\"].validate(valid => {\n                    if (valid) {\n                    if (this.form.sopId != null) {\n                        updateSop(this.form).then(response => {\n                        this.$modal.msgSuccess(\"修改成功\");\n                        this.open = false;\n                        this.getList();\n                        });\n                    } else {\n                        addSop(this.form).then(response => {\n                        this.$modal.msgSuccess(\"新增成功\");\n                        this.open = false;\n                        this.getList();\n                        });\n                    }\n                    }\n                });\n        },\n        /** 删除按钮操作 */\n        handleDelete(row) {\n            const sopIds = row.sopId || this.ids;\n            this.$modal.confirm('是否确认删除产品SOP编号为\"' + sopIds + '\"的数据项？').then(function() {\n                return delSop(sopIds);\n            }).then(() => {\n                this.getList();\n                this.$modal.msgSuccess(\"删除成功\");\n            }).catch(() => {});\n        },\n    }\n}\n</script>\n<style scoped>\n    .header {\n        margin-left: 15px;\n        font-size: 30px;\n        font-weight: 600;\n    }\n\n    .images {\n        display: flex;\n        margin-top: 20px;\n        margin-left: 21px;\n        margin-right: 20px;\n        flex-wrap: wrap;\n    }\n\n    .image-middle{\n        margin-right: 15px;\n        margin-bottom: 15px;\n    }\n\n    .image{\n        width:110px;\n        height: 110px;\n    }\n\n    .imagePreview {\n        width: 600px;\n        height: 500px;\n    }\n</style>"]}]}