{"remainingRequest":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\src\\views\\mes\\md\\mditem\\components\\sop.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\src\\views\\mes\\md\\mditem\\components\\sop.vue","mtime":1665505269000},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1662432868786},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\babel-loader\\lib\\index.js","mtime":1662432871518},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1662432868786},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\vue-loader\\lib\\index.js","mtime":1662432874590}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGxpc3RTb3AsIGdldFNvcCwgZGVsU29wLCBhZGRTb3AsIHVwZGF0ZVNvcCB9IGZyb20gIkAvYXBpL21lcy9tZC9zb3AiOwppbXBvcnQgSW1hZ2VVcGxvYWQgZnJvbSAiQC9jb21wb25lbnRzL0ltYWdlVXBsb2FkL2luZGV4LnZ1ZSIKaW1wb3J0IHtsaXN0QWxsUHJvY2Vzc30gZnJvbSAiQC9hcGkvbWVzL3Byby9wcm9jZXNzIjsKZXhwb3J0IGRlZmF1bHR7CiAgICBuYW1lOiAiU09QVGFiIiwKICAgIGNvbXBvbmVudHM6IHtJbWFnZVVwbG9hZH0sCiAgICBwcm9wczp7CiAgICAgICAgaXRlbUlkOiBudWxsLAogICAgICAgIG9wdFR5cGU6IG51bGwsCiAgICB9LAogICAgZGF0YSgpewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHRpdGxlOiAi5paw5aKeU09Q5L+h5oGvIiwKICAgICAgICAgICAgbG9hZGluZzogdHJ1ZSwKICAgICAgICAgICAgb3BlbjogZmFsc2UsICAgICAgCiAgICAgICAgICAgIC8vIOihqOWNleWPguaVsAogICAgICAgICAgICBmb3JtOiB7fSwKICAgICAgICAgICAgLy8g6KGo5Y2V5qCh6aqMCiAgICAgICAgICAgIHJ1bGVzOiB7CiAgICAgICAgICAgICAgICBpdGVtSWQ6IFsKICAgICAgICAgICAgICAgICAgICB7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAi54mp5paZ5Lqn5ZOBSUTkuI3og73kuLrnqboiLCB0cmlnZ2VyOiAiYmx1ciIgfQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgfSwgICAgIAogICAgICAgICAgICAvLyDkuqflk4FTT1DooajmoLzmlbDmja4KICAgICAgICAgICAgc29wTGlzdDogW10sIAogICAgICAgICAgICAvL+eUqOS6juWbvueJh+mihOiniOeahOa4heWNlQogICAgICAgICAgICBpbWFnZUxpc3Q6IFtdLAogICAgICAgICAgICAvL+W3peW6j+mAiemhuQogICAgICAgICAgICBwcm9jZXNzT3B0aW9uczpbXSwKICAgICAgICAgICAgcXVlcnlQYXJhbXM6IHsKICAgICAgICAgICAgICAgIGl0ZW1JZDogdGhpcy5pdGVtSWQKICAgICAgICAgICAgfSAgICAgICAgICAgIAogICAgICAgIH0KICAgIH0sCiAgICBjcmVhdGVkKCl7CiAgICAgICAgdGhpcy5nZXRMaXN0KCk7CiAgICAgICAgdGhpcy5nZXRQcm9jZXNzKCk7CiAgICB9LAogICAgbWV0aG9kczogewogICAgICAgIC8v6I635Y+W5b2T5YmN5Lqn5ZOB55qEU09Q6LWE5paZ5riF5Y2VCiAgICAgICAgZ2V0TGlzdCgpewogICAgICAgICAgICBsaXN0U29wKHRoaXMucXVlcnlQYXJhbXMpLnRoZW4ocmVzcG9uc2UgPT57CiAgICAgICAgICAgICAgICBkZWJ1Z2dlcjsKICAgICAgICAgICAgICAgIHRoaXMuaW1hZ2VMaXN0ID0gW107CiAgICAgICAgICAgICAgICB0aGlzLnNvcExpc3QgPSByZXNwb25zZS5yb3dzOwogICAgICAgICAgICAgICAgdGhpcy5zb3BMaXN0LmZvckVhY2gocm93ID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmltYWdlTGlzdC5wdXNoKHJvdy5zb3BVcmwpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgIC8v5p+l6K+i5bel5bqP5L+h5oGvCiAgICAgICAgZ2V0UHJvY2VzcygpewogICAgICAgICAgICBsaXN0QWxsUHJvY2VzcygpLnRoZW4oIHJlc3BvbnNlID0+ewogICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzT3B0aW9ucyA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgLy8g5Y+W5raI5oyJ6ZKuCiAgICAgICAgY2FuY2VsKCkgewogICAgICAgICAgICB0aGlzLm9wZW4gPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5yZXNldCgpOwogICAgICAgIH0sCiAgICAgICAgLy8g6KGo5Y2V6YeN572uCiAgICAgICAgcmVzZXQoKSB7CiAgICAgICAgICAgIHRoaXMuZm9ybSA9IHsKICAgICAgICAgICAgICAgIHNvcElkOiBudWxsLAogICAgICAgICAgICAgICAgaXRlbUlkOiB0aGlzLml0ZW1JZCwKICAgICAgICAgICAgICAgIG9yZGVyTnVtOiBudWxsLAogICAgICAgICAgICAgICAgcHJvY2Vzc0lkOiBudWxsLAogICAgICAgICAgICAgICAgcHJvY2Vzc0NvZGU6IG51bGwsCiAgICAgICAgICAgICAgICBwcm9jZXNzTmFtZTogbnVsbCwKICAgICAgICAgICAgICAgIHNvcFRpdGxlOiBudWxsLAogICAgICAgICAgICAgICAgc29wRGVzY3JpcHRpb246IG51bGwsCiAgICAgICAgICAgICAgICBzb3BVcmw6IG51bGwgICAgICAgICAgICAgICAKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy5yZXNldEZvcm0oImZvcm0iKTsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIOaWsOWinuaTjeS9nAogICAgICAgICAqLwogICAgICAgIGhhbmRsZUFkZCgpewogICAgICAgICAgICB0aGlzLnJlc2V0KCk7CiAgICAgICAgICAgIHRoaXMub3BlbiA9IHRydWU7CiAgICAgICAgICAgIHRoaXMudGl0bGUgPSAi5re75Yqg5Lqn5ZOBU09QIjsKICAgICAgICB9LAogICAgICAgIC8qKiDkv67mlLnmjInpkq7mk43kvZwgKi8KICAgICAgICBoYW5kbGVVcGRhdGUocm93KSB7CiAgICAgICAgICAgIHRoaXMucmVzZXQoKTsKICAgICAgICAgICAgY29uc3Qgc29wSWQgPSByb3cuc29wSWQgfHwgdGhpcy5pZHMKICAgICAgICAgICAgZ2V0U29wKHNvcElkKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuZm9ybSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgICB0aGlzLm9wZW4gPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy50aXRsZSA9ICLkv67mlLnkuqflk4FTT1AiOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIC8v5Zu+54mH5LiK5Lyg5oiQ5YqfCiAgICAgICAgaGFuZGxlSW1nVXBsYW9kZWQoaW1nVXJsKXsKICAgICAgICAgICAgY29uc29sZS5sb2coaW1nVXJsKTsKICAgICAgICAgICAgdGhpcy5mb3JtLnNvcFVybCA9IGltZ1VybDsKICAgICAgICB9LAogICAgICAgIC8v5Zu+54mH56e76ZmkCiAgICAgICAgaGFuZGxlSW1nUmVtb3ZlZChpbWdVcmwpewogICAgICAgICAgICBjb25zb2xlLmxvZyhpbWdVcmwpOwogICAgICAgICAgICB0aGlzLmZvcm0uc29wVXJsID0gbnVsbDsgICAgICAgICAgICAKICAgICAgICB9LAogICAgICAgIC8v5o+Q5LqkCiAgICAgICAgc3VibWl0Rm9ybSgpewogICAgICAgICAgICB0aGlzLiRyZWZzWyJmb3JtIl0udmFsaWRhdGUodmFsaWQgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvcm0uc29wSWQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVTb3AodGhpcy5mb3JtKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbW9kYWwubXNnU3VjY2Vzcygi5L+u5pS55oiQ5YqfIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3BlbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldExpc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkU29wKHRoaXMuZm9ybSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJG1vZGFsLm1zZ1N1Y2Nlc3MoIuaWsOWinuaIkOWKnyIpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW4gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRMaXN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIC8qKiDliKDpmaTmjInpkq7mk43kvZwgKi8KICAgICAgICBoYW5kbGVEZWxldGUocm93KSB7CiAgICAgICAgICAgIGNvbnN0IHNvcElkcyA9IHJvdy5zb3BJZCB8fCB0aGlzLmlkczsKICAgICAgICAgICAgdGhpcy4kbW9kYWwuY29uZmlybSgn5piv5ZCm56Gu6K6k5Yig6Zmk5Lqn5ZOBU09Q57yW5Y+35Li6IicgKyBzb3BJZHMgKyAnIueahOaVsOaNrumhue+8nycpLnRoZW4oZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZGVsU29wKHNvcElkcyk7CiAgICAgICAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5nZXRMaXN0KCk7CiAgICAgICAgICAgICAgICB0aGlzLiRtb2RhbC5tc2dTdWNjZXNzKCLliKDpmaTmiJDlip8iKTsKICAgICAgICAgICAgfSkuY2F0Y2goKCkgPT4ge30pOwogICAgICAgIH0sCiAgICB9Cn0K"},{"version":3,"sources":["sop.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"sop.vue","sourceRoot":"src/views/mes/md/mditem/components","sourcesContent":["<template>\n    <div class=\"app-container\">\n        <el-row v-if=\"optType != 'view'\" :gutter=\"10\" class=\"mb8\">\n            <el-col :span=\"1.5\">\n                <el-button\n                type=\"primary\"\n                plain\n                icon=\"el-icon-plus\"\n                size=\"mini\"\n                @click=\"handleAdd\"\n                v-hasPermi=\"['mes:md:sop:add']\"\n                >新增</el-button>\n            </el-col>\n        </el-row>\n        <div class=\"header\">\n            <el-dialog :title=\"title\" :visible.sync=\"open\" width=\"960px\" append-to-body>\n                <el-form ref=\"form\" :model=\"form\" :rules=\"rules\" label-width=\"100px\">\n                    <el-form-item label=\"标题\" prop=\"sopTitle\">\n                        <el-input v-model=\"form.sopTitle\" placeholder=\"请输入标题\"></el-input>\n                    </el-form-item>\n                    <el-form-item label=\"展示顺序\">\n                        <el-input-number :min=\"1\" v-model=\"form.orderNum\"></el-input-number>\n                    </el-form-item>\n                    <el-form-item label=\"内容说明\">\n                        <el-input type=\"textarea\" v-model=\"form.sopDescription\" placeholder=\"请输入说明信息\"></el-input>\n                    </el-form-item>\n                    <el-form-item label=\"所属工序\" prop=\"processId\">\n                        <el-select v-model=\"form.processId\" placeholder=\"请选择工序\">\n                            <el-option\n                            v-for=\"item in processOptions\"\n                            :key=\"item.processId\"\n                            :label=\"item.processName\"\n                            :value=\"item.processId\"\n                            ></el-option>\n                        </el-select>\n                    </el-form-item>\n                    <el-form-item label=\"图片\">\n                        <ImageUpload :limit=\"1\" :value=\"form.sopUrl\" :fileSize=\"5\" @onUploaded=\"handleImgUplaoded\" @onRemoved=\"handleImgRemoved\" ></ImageUpload>\n                    </el-form-item>                    \n                </el-form>\n                <div slot=\"footer\" class=\"dialog-footer\">\n                    <el-button type=\"primary\" @click=\"submitForm\">提 交</el-button>\n                    <el-button @click=\"cancel\">取 消</el-button>\n                </div>\n            </el-dialog>\n        </div>\n        <div class=\"images\">\n            <div v-for=\"(item,index) in sopList\" :key=\"index\" class=\"image-middle\">\n                <el-card shadow=\"hover\" :body-style=\"{pading: '10px'}\">\n                    <el-popover>\n                        <img :src=\"sopList[index].sopUrl\" slot=\"reference\" class=\"image\"/>\n                        <el-image class=\"imagePreview\" :src=\"sopList[index].sopUrl\" :preview-src-list=\"imageList\"></el-image>                        \n                    </el-popover>\n                    <div style=\"text-align:center;padding-top:12px\">\n                        <span>\n                            {{sopList[index].sopTitle}}\n                        </span>\n                        <el-button @click=\"handleUpdate(sopList[index])\" type=\"primary\" icon=\"el-icon-edit\"></el-button>\n                        <el-button @click=\"handleDelete(sopList[index])\" type=\"danger\" icon=\"el-icon-delete\"></el-button>\n                    </div>\n                </el-card>\n            </div>\n        </div>\n    </div>\n</template>\n<script>\nimport { listSop, getSop, delSop, addSop, updateSop } from \"@/api/mes/md/sop\";\nimport ImageUpload from \"@/components/ImageUpload/index.vue\"\nimport {listAllProcess} from \"@/api/mes/pro/process\";\nexport default{\n    name: \"SOPTab\",\n    components: {ImageUpload},\n    props:{\n        itemId: null,\n        optType: null,\n    },\n    data(){\n        return {\n            title: \"新增SOP信息\",\n            loading: true,\n            open: false,      \n            // 表单参数\n            form: {},\n            // 表单校验\n            rules: {\n                itemId: [\n                    { required: true, message: \"物料产品ID不能为空\", trigger: \"blur\" }\n                ],\n            },     \n            // 产品SOP表格数据\n            sopList: [], \n            //用于图片预览的清单\n            imageList: [],\n            //工序选项\n            processOptions:[],\n            queryParams: {\n                itemId: this.itemId\n            }            \n        }\n    },\n    created(){\n        this.getList();\n        this.getProcess();\n    },\n    methods: {\n        //获取当前产品的SOP资料清单\n        getList(){\n            listSop(this.queryParams).then(response =>{\n                debugger;\n                this.imageList = [];\n                this.sopList = response.rows;\n                this.sopList.forEach(row => {\n                    this.imageList.push(row.sopUrl);\n                });\n            });\n        },\n         //查询工序信息\n        getProcess(){\n            listAllProcess().then( response =>{\n                this.processOptions = response.data;\n            });\n        },\n        // 取消按钮\n        cancel() {\n            this.open = false;\n            this.reset();\n        },\n        // 表单重置\n        reset() {\n            this.form = {\n                sopId: null,\n                itemId: this.itemId,\n                orderNum: null,\n                processId: null,\n                processCode: null,\n                processName: null,\n                sopTitle: null,\n                sopDescription: null,\n                sopUrl: null               \n            };\n            this.resetForm(\"form\");\n        },\n        /**\n         * 新增操作\n         */\n        handleAdd(){\n            this.reset();\n            this.open = true;\n            this.title = \"添加产品SOP\";\n        },\n        /** 修改按钮操作 */\n        handleUpdate(row) {\n            this.reset();\n            const sopId = row.sopId || this.ids\n            getSop(sopId).then(response => {\n                this.form = response.data;\n                this.open = true;\n                this.title = \"修改产品SOP\";\n            });\n        },\n        //图片上传成功\n        handleImgUplaoded(imgUrl){\n            console.log(imgUrl);\n            this.form.sopUrl = imgUrl;\n        },\n        //图片移除\n        handleImgRemoved(imgUrl){\n            console.log(imgUrl);\n            this.form.sopUrl = null;            \n        },\n        //提交\n        submitForm(){\n            this.$refs[\"form\"].validate(valid => {\n                    if (valid) {\n                    if (this.form.sopId != null) {\n                        updateSop(this.form).then(response => {\n                        this.$modal.msgSuccess(\"修改成功\");\n                        this.open = false;\n                        this.getList();\n                        });\n                    } else {\n                        addSop(this.form).then(response => {\n                        this.$modal.msgSuccess(\"新增成功\");\n                        this.open = false;\n                        this.getList();\n                        });\n                    }\n                    }\n                });\n        },\n        /** 删除按钮操作 */\n        handleDelete(row) {\n            const sopIds = row.sopId || this.ids;\n            this.$modal.confirm('是否确认删除产品SOP编号为\"' + sopIds + '\"的数据项？').then(function() {\n                return delSop(sopIds);\n            }).then(() => {\n                this.getList();\n                this.$modal.msgSuccess(\"删除成功\");\n            }).catch(() => {});\n        },\n    }\n}\n</script>\n<style scoped>\n    .header {\n        margin-left: 15px;\n        font-size: 30px;\n        font-weight: 600;\n    }\n\n    .images {\n        display: flex;\n        margin-top: 20px;\n        margin-left: 21px;\n        margin-right: 20px;\n        flex-wrap: wrap;\n    }\n\n    .image-middle{\n        margin-right: 15px;\n        margin-bottom: 15px;\n    }\n\n    .image{\n        width:110px;\n        height: 110px;\n    }\n\n    .imagePreview {\n        width: 600px;\n        height: 500px;\n    }\n</style>"]}]}