{"remainingRequest":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\babel-loader\\lib\\index.js!D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\src\\views\\mes\\pro\\schedule\\ganttedit.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\src\\views\\mes\\pro\\schedule\\ganttedit.vue","mtime":1662109326000},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\babel.config.js","mtime":1662109326000},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1662432868786},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\babel-loader\\lib\\index.js","mtime":1662432871518},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1662432868786},{"path":"D:\\resource\\eclipse-workspace\\ktg-mes-master\\ktg-mes-ui-master\\node_modules\\vue-loader\\lib\\index.js","mtime":1662432874590}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIuanMiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgR2FudHRDaGFyIGZyb20gIi4vZ2FudHR4LnZ1ZSI7CmltcG9ydCB7IGxpc3RHYW50dFRhc2tMaXN0LCB1cGRhdGVQcm90YXNrIH0gZnJvbSAiQC9hcGkvbWVzL3Byby9wcm90YXNrIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICcnLAogIGNvbXBvbmVudHM6IHsKICAgIEdhbnR0Q2hhcjogR2FudHRDaGFyCiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdGFza3M6IHsKICAgICAgICBkYXRhOiBbXSwKICAgICAgICBsaW5rczogW10KICAgICAgfSwKICAgICAgY2hhbmdlZFRhc2tJZHM6IFtdLAogICAgICBvcHRUeXBlOiAnZWRpdCcsCiAgICAgIC8vIOafpeivouWPguaVsAogICAgICBxdWVyeVBhcmFtczogewogICAgICAgIHdvcmtvcmRlckNvZGU6IG51bGwsCiAgICAgICAgd29ya29yZGVyTmFtZTogbnVsbCwKICAgICAgICBvcmRlclNvdXJjZTogbnVsbCwKICAgICAgICBzb3VyY2VDb2RlOiBudWxsLAogICAgICAgIHByb2R1Y3RJZDogbnVsbCwKICAgICAgICBwcm9kdWN0Q29kZTogbnVsbCwKICAgICAgICBwcm9kdWN0TmFtZTogbnVsbCwKICAgICAgICBwcm9kdWN0U3BjOiBudWxsLAogICAgICAgIHVuaXRPZk1lYXN1cmU6IG51bGwsCiAgICAgICAgcXVhbnRpdHk6IG51bGwsCiAgICAgICAgcXVhbnRpdHlQcm9kdWNlZDogbnVsbCwKICAgICAgICBxdWFudGl0eUNoYW5nZWQ6IG51bGwsCiAgICAgICAgcXVhbnRpdHlTY2hlZHVsZWQ6IG51bGwsCiAgICAgICAgY2xpZW50SWQ6IG51bGwsCiAgICAgICAgY2xpZW50Q29kZTogbnVsbCwKICAgICAgICBjbGllbnROYW1lOiBudWxsLAogICAgICAgIHJlcXVlc3REYXRlOiBudWxsLAogICAgICAgIHBhcmVudElkOiBudWxsLAogICAgICAgIGFuY2VzdG9yczogbnVsbCwKICAgICAgICBzdGF0dXM6IG51bGwKICAgICAgfSwKICAgICAgZm9ybTogewogICAgICAgIHRhc2tJZDogbnVsbCwKICAgICAgICBzdGFydFRpbWU6IG51bGwsCiAgICAgICAgZHVyYXRpb246IG51bGwsCiAgICAgICAgZW5kVGltZTogbnVsbAogICAgICB9CiAgICB9OwogIH0sCiAgd2F0Y2g6IHsKICAgIHRhc2tzOiBmdW5jdGlvbiB0YXNrcygpIHsKICAgICAgY29uc29sZS5sb2coIlRhc2tDaGFuZ2VkIik7CiAgICB9CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgdGhpcy5nZXRHYW50dFRhc2tzKCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBnZXRHYW50dFRhc2tzOiBmdW5jdGlvbiBnZXRHYW50dFRhc2tzKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgbGlzdEdhbnR0VGFza0xpc3QodGhpcy5xdWVyeVBhcmFtcykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpcy50YXNrcy5kYXRhID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgIF90aGlzLnRhc2tzLmxpbmtzID0gcmVzcG9uc2UuZGF0YS5saW5rczsKCiAgICAgICAgX3RoaXMuJHJlZnMuZ2FudHRDaGFyLnJlbG9hZCgpOwogICAgICB9KTsKICAgIH0sCiAgICBoYW5kbGVVcGRhdGU6IGZ1bmN0aW9uIGhhbmRsZVVwZGF0ZSgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICBkZWJ1Z2dlcjsKCiAgICAgIGlmICh0aGlzLmNoYW5nZWRUYXNrSWRzLmxlbmd0aCA+IDApIHsKICAgICAgICB0aGlzLnJlc2V0KCk7CiAgICAgICAgdGhpcy5jaGFuZ2VkVGFza0lkcy5mb3JFYWNoKGZ1bmN0aW9uIChpZCkgewogICAgICAgICAgZGVidWdnZXI7CgogICAgICAgICAgdmFyIG5UYXNrID0gX3RoaXMyLnRhc2tzLmRhdGEuZmlsdGVyKGZ1bmN0aW9uICh0YXNrKSB7CiAgICAgICAgICAgIHJldHVybiB0YXNrLmlkID09IGlkOwogICAgICAgICAgfSlbMF07CgogICAgICAgICAgdmFyIHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKG5UYXNrLnN0YXJ0X2RhdGUpOwogICAgICAgICAgdmFyIGVuZERhdGUgPSBuZXcgRGF0ZShuVGFzay5lbmRfZGF0ZSk7CiAgICAgICAgICBfdGhpczIuZm9ybS50YXNrSWQgPSBuVGFzay5pZDsKICAgICAgICAgIF90aGlzMi5mb3JtLnN0YXJ0VGltZSA9IHN0YXJ0RGF0ZS5nZXRGdWxsWWVhcigpICsgJy0nICsgKHN0YXJ0RGF0ZS5nZXRNb250aCgpICsgMSkgKyAnLScgKyBzdGFydERhdGUuZ2V0RGF0ZSgpICsgJyAnICsgc3RhcnREYXRlLmdldEhvdXJzKCkgKyAnOicgKyBzdGFydERhdGUuZ2V0TWludXRlcygpICsgJzonICsgc3RhcnREYXRlLmdldFNlY29uZHMoKTsKICAgICAgICAgIF90aGlzMi5mb3JtLmR1cmF0aW9uID0gblRhc2suZHVyYXRpb247CiAgICAgICAgICBfdGhpczIuZm9ybS5lbmRUaW1lID0gZW5kRGF0ZS5nZXRGdWxsWWVhcigpICsgJy0nICsgKGVuZERhdGUuZ2V0TW9udGgoKSArIDEpICsgJy0nICsgZW5kRGF0ZS5nZXREYXRlKCkgKyAnICcgKyBlbmREYXRlLmdldEhvdXJzKCkgKyAnOicgKyBlbmREYXRlLmdldE1pbnV0ZXMoKSArICc6JyArIGVuZERhdGUuZ2V0U2Vjb25kcygpOwogICAgICAgICAgdXBkYXRlUHJvdGFzayhfdGhpczIuZm9ybSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coInVwZGF0ZSBzdWNjZXNzOiIgKyBpZCk7CiAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICAgIGRlYnVnZ2VyOwogICAgICAgICAgICBjb25zb2xlLmxvZygidXBkYXRlIGZhaWxlZDoiICsgZXJyLm1zZyk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLmNoYW5nZWRUYXNrSWRzID0gW107CiAgICAgICAgdGhpcy4kbW9kYWwubXNnU3VjY2Vzcygi5L+d5a2Y5oiQ5YqfIik7CiAgICAgIH0KICAgIH0sCiAgICBoYW5kbGVSZWZyZXNoOiBmdW5jdGlvbiBoYW5kbGVSZWZyZXNoKCkgewogICAgICB0aGlzLiRyZWZzLmdhbnR0Q2hhci5yZWxvYWQoKTsKICAgIH0sCiAgICBoYW5kbGVDbG9zZTogZnVuY3Rpb24gaGFuZGxlQ2xvc2UoKSB7CiAgICAgIHZhciBvYmogPSB7CiAgICAgICAgcGF0aDogIi9tZXMvcHJvL3Byb3NjaGVkdWxlIgogICAgICB9OwogICAgICB0aGlzLiR0YWIuY2xvc2VPcGVuUGFnZShvYmopOwogICAgfSwKICAgIHJlc2V0OiBmdW5jdGlvbiByZXNldCgpIHsKICAgICAgdGhpcy5mb3JtID0gewogICAgICAgIHRhc2tJZDogbnVsbCwKICAgICAgICBzdGFydFRpbWU6IG51bGwsCiAgICAgICAgZHVyYXRpb246IG51bGwsCiAgICAgICAgZW5kVGltZTogbnVsbAogICAgICB9OwogICAgfQogIH0KfTs="},{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0CA;AACA;AACA;EACAA,QADA;EAEAC;IAAAC;EAAA,CAFA;EAGAC,IAHA,kBAGA;IACA;MACAC;QACAD,QADA;QAEAE;MAFA,CADA;MAKAC,kBALA;MAMAC,eANA;MAOA;MACAC;QACAC,mBADA;QAEAC,mBAFA;QAGAC,iBAHA;QAIAC,gBAJA;QAKAC,eALA;QAMAC,iBANA;QAOAC,iBAPA;QAQAC,gBARA;QASAC,mBATA;QAUAC,cAVA;QAWAC,sBAXA;QAYAC,qBAZA;QAaAC,uBAbA;QAcAC,cAdA;QAeAC,gBAfA;QAgBAC,gBAhBA;QAiBAC,iBAjBA;QAkBAC,cAlBA;QAmBAC,eAnBA;QAoBAC;MApBA,CARA;MA8BAC;QACAC,YADA;QAEAC,eAFA;QAGAC,cAHA;QAIAC;MAJA;IA9BA;EAqCA,CAzCA;EA0CAC;IACA9B,KADA,mBACA;MACA+B;IACA;EAHA,CA1CA;EA+CAC,OA/CA,qBA+CA;IACA;EACA,CAjDA;EAkDAC;IACAC,aADA,2BACA;MAAA;;MACAC;QACA;QACA;;QACA;MACA,CAJA;IAKA,CAPA;IAQAC,YARA,0BAQA;MAAA;;MACA;;MACA;QACA;QACA;UACA;;UACA;YAAA;UAAA;;UACA;UACA;UACA;UACA;UACA;UACA;UACAC;YACAN;UACA,CAFA,EAEA;YACA;YACAA;UACA,CALA;QAMA,CAfA;QAgBA;QACA;MACA;IACA,CA/BA;IAgCAO,aAhCA,2BAgCA;MACA;IACA,CAlCA;IAmCAC,WAnCA,yBAmCA;MACA;QAAAC;MAAA;MACA;IACA,CAtCA;IAuCAC,KAvCA,mBAuCA;MACA;QACAf,YADA;QAEAC,eAFA;QAGAC,cAHA;QAIAC;MAJA;IAMA;EA9CA;AAlDA","names":["name","components","GanttChar","data","tasks","links","changedTaskIds","optType","queryParams","workorderCode","workorderName","orderSource","sourceCode","productId","productCode","productName","productSpc","unitOfMeasure","quantity","quantityProduced","quantityChanged","quantityScheduled","clientId","clientCode","clientName","requestDate","parentId","ancestors","status","form","taskId","startTime","duration","endTime","watch","console","created","methods","getGanttTasks","listGanttTaskList","handleUpdate","updateProtask","handleRefresh","handleClose","path","reset"],"sourceRoot":"src/views/mes/pro/schedule","sources":["ganttedit.vue"],"sourcesContent":["<template>\n    <div class=\"app-container\">\n    <el-row :gutter=\"10\" class=\"mb8\">\n      <el-col :span=\"1\"></el-col>\n      <el-col :span=\"1.5\">\n        <el-button\n          type=\"success\"\n          plain\n          icon=\"el-icon-edit\"\n          size=\"mini\"\n          @click=\"handleUpdate\"\n          v-hasPermi=\"['mes:pro:schedule:edit']\"\n        >保存</el-button>\n      </el-col>\n      <el-col :span=\"1.5\">\n        <el-button\n          type=\"danger\"\n          plain\n          icon=\"el-icon-delete\"\n          size=\"mini\"\n          @click=\"handleClose\"\n        >关闭</el-button>\n      </el-col>\n      <el-col :span=\"1.5\">\n        <el-button\n          type=\"warning\"\n          plain\n          icon=\"el-icon-refresh\"\n          size=\"mini\"\n          @click=\"handleRefresh\"\n        >重新加载</el-button>\n      </el-col>\n    </el-row>\n    <div class=\"wrapper\">\n      <div class=\"container\">\n        <GanttChar class=\"left-container\" ref=\"ganttChar\" optType=\"edit\" :ids=\"changedTaskIds\" :tasks=\"tasks\"></GanttChar>\n      </div>      \n    </div> \n    </div>\n</template>\n\n<script>\nimport GanttChar from \"./ganttx.vue\";\nimport {listGanttTaskList,updateProtask} from \"@/api/mes/pro/protask\";\nexport default {\n    name:'',\n    components:{GanttChar},\n    data(){\n        return {\n            tasks:{\n                data: [],\n                links: []\n            },\n            changedTaskIds:[],\n            optType:'edit',\n            // 查询参数\n            queryParams: {\n                workorderCode: null,\n                workorderName: null,\n                orderSource: null,\n                sourceCode: null,\n                productId: null,\n                productCode: null,\n                productName: null,\n                productSpc: null,\n                unitOfMeasure: null,\n                quantity: null,\n                quantityProduced: null,\n                quantityChanged: null,\n                quantityScheduled: null,\n                clientId: null,\n                clientCode: null,\n                clientName: null,\n                requestDate: null,\n                parentId: null,\n                ancestors: null,\n                status: null,\n            },\n            form:{\n                taskId: null,                              \n                startTime: null,\n                duration: null,\n                endTime: null            \n            }\n        }\n    },\n    watch: {\n        tasks(){\n            console.log(\"TaskChanged\");\n        }\n    },\n    created(){\n        this.getGanttTasks();\n    },\n    methods: {\n        getGanttTasks(){\n            listGanttTaskList(this.queryParams).then(response =>{\n                this.tasks.data = response.data.data;\n                this.tasks.links = response.data.links;\n                this.$refs.ganttChar.reload();\n            });\n        },\n        handleUpdate(){\n            debugger;\n            if(this.changedTaskIds.length>0){\n                this.reset();\n                this.changedTaskIds.forEach(id => {\n                    debugger;\n                    let nTask = this.tasks.data.filter(task => task.id == id)[0];\n                    let startDate = new Date(nTask.start_date);\n                    let endDate = new Date(nTask.end_date);\n                    this.form.taskId = nTask.id;\n                    this.form.startTime = startDate.getFullYear()+'-'+(startDate.getMonth()+1)+'-'+startDate.getDate()+' '+startDate.getHours()+':'+startDate.getMinutes()+':'+startDate.getSeconds();\n                    this.form.duration = nTask.duration;\n                    this.form.endTime = endDate.getFullYear()+'-'+(endDate.getMonth()+1)+'-'+endDate.getDate()+' '+endDate.getHours()+':'+endDate.getMinutes()+':'+endDate.getSeconds();\n                    updateProtask(this.form).then(response =>{\n                        console.log(\"update success:\"+id);\n                    },err =>{\n                        debugger;\n                        console.log(\"update failed:\"+err.msg);\n                    });\n                });\n                this.changedTaskIds =[];                \n                this.$modal.msgSuccess(\"保存成功\");\n            }            \n        },\n        handleRefresh(){\n            this.$refs.ganttChar.reload();\n        },\n        handleClose(){\n            const obj = { path: \"/mes/pro/proschedule\" };\n            this.$tab.closeOpenPage(obj);\n        },\n        reset() {\n            this.form = {\n                taskId: null,\n                startTime: null,\n                duration: null,\n                endTime: null,\n            };\n        },\n\n    }\n}\n</script>\n\n<style scoped>\n.wrapper{\n    height: 700px;\n}\n.container {\n  height: 100%;\n  width: 100%;\n}\n.left-container {\n  overflow: hidden;\n  position: relative;\n  height: 100%;\n}\n</style>"]}]}